<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Customizing a Docker image Problem : Sometimes you have to use Docker images to troubleshoot R package issues. One of the tasks associated with this if for example the installation of system and R...">
        <meta name="keywords" content="Docker image. Dockerfile">
        <link rel="icon" href="https://mohcinemadkour.github.io/favicon.ico">

        <title>Customizing a Docker image - A Pelican Blog</title>

        <!-- Stylesheets -->
        <link href="https://mohcinemadkour.github.io/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://mohcinemadkour.github.io/images/data-lake-background.png'); background-position: center; background-size: cover;">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://mohcinemadkour.github.io/"><img class="mr20" src="https://mohcinemadkour.github.io/images/logo.svg" alt="logo">A Pelican Blog</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://mohcinemadkour.github.io/pdfs/mohcine_madkour_cv.pdf">CV-Resume</a>
                                <a href="https://mohcinemadkour.github.io/categories.html">Categories</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Customizing a Docker image</h1>
                      <p class="header-date">By <a href="https://mohcinemadkour.github.io/author/mohcine-madkour.html">Mohcine Madkour</a>, Tue 12 June 2018, in category <a href="https://mohcinemadkour.github.io/category/docker.html">Docker</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://mohcinemadkour.github.io/tag/docker-image-dockerfile.html">Docker image. Dockerfile</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <h1>Customizing a Docker image</h1>
<p>Problem : Sometimes you have to use Docker images to troubleshoot R package issues. One of the tasks associated with this if for example the installation of system and R dependencies. This installation can be somewhat time consuming. In order to avoid this we can customize a container so that it has the dependencies we need. Here we’ll see how this is accomplished.</p>
<p>We’ve been using the rocker r-devel-san-clang container. A first step is to fork this repository to your own account. The rocker repository can be found here.</p>
<p>https://github.com/mohcinemadkour/r-devel-san-clang
You should be able to find a button in the top right of the page where you can fork the repository. We can now clone it to make a local copy.</p>
<div class="highlight"><pre><span></span>git clone https://github.com/mohcinemadkour/r-devel-san-clang.git
</pre></div>


<p>We can make a branch so that we keep our work seperate from master. Information on branching can be found at the <a href="https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging">git documentation</a>.</p>
<div class="highlight"><pre><span></span>git checkout -b bjk
</pre></div>


<p>We can now open the Dockerfile in our favorite text editor and customize it. In the Dockerfile we’ll see a couplpe of lines as follows.</p>
<div class="highlight"><pre><span></span>RUN apt-get update -qq \
    &amp;&amp; apt-get install -t unstable -y --no-install-recommends \
</pre></div>


<p>This is where we’ll add our system dependencies. Docker’s best practices guide asks us to add our dependencies alphabetically to aid maintenance. We’ll add pandoc and qpdf.</p>
<p>At the end of the file we’ll add a few lines to install our dependencies. For your package you will want to modify this list.</p>
<h2>Install vcfR dependencies</h2>
<div class="highlight"><pre><span></span>RUN R --slave -e &#39;install.packages(c(&quot;ape&quot;, &quot;dplyr&quot;, &quot;knitr&quot;, &quot;poppr&quot;, &quot;Rcpp&quot;, &quot;memuse&quot;, &quot;pinfsc50&quot;, &quot;rmarkdown&quot;, &quot;testthat&quot;, &quot;tidyr&quot;, &quot;vegan&quot;, &quot;viridisLite&quot;), dependencies = TRUE)&#39;
</pre></div>


<p>The Docker documentation includes directions on how to build our app. For our container it should look like this.</p>
<div class="highlight"><pre><span></span>sudo docker build -t r-devel-san-clang .
</pre></div>


<p>Here the -t flag allows us to add a tag. Note that it will take a bit for the dependencies to download and install. Okay, it will take quite a bit.</p>
<p>After everything is installed we should be able to start the image</p>
<div class="highlight"><pre><span></span>sudo docker run --name=r-devel-san-clang -v ~/gits/vcfR:/RSource/vcfR --rm -ti r-devel-san-clang /bin/bash
</pre></div>


<p>While building the container requires an investment in time, the result is that now when we run our image we have all of our dependencies installed and do not have to invest time in to install them. We should be ready to proceed to testing our docker now.</p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'leafyleap-2';
                var disqus_identifier = 'Customizing a Docker image.html';
                var disqus_url = 'https://mohcinemadkour.github.io/Customizing a Docker image.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://mohcinemadkour.github.io/archives.html">Archives</a></li>
                            <li><a href="https://mohcinemadkour.github.io/tags.html">Tags</a></li>
                            <li><a href="https://mohcinemadkour.github.io/authors.html">Authors</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://www.meetup.com/members/112481792//" target="_blank">meetup</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="https://www.linkedin.com/in/mohcine-madkour-83a642b2//" target="_blank">LinkedIn</a></li>
                            <li><a href="https://github.com/mohcinemadkour/" target="_blank">Github</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; leafyleap 2017</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>