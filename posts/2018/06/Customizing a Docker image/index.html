<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mohcine Madkour, Big Data Architectures and more">


        <title>Customizing a Docker image // Mohcine Madkour // Big Data Architectures and more</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../theme/css/pure.css">
    <link rel="stylesheet" href="../../../../theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <a href="../../../../author/mohcine-madkour.html" title="See posts by Mohcine Madkour">
                </a>
                <h2 class="article-info">Mohcine Madkour</h2>
                <small class="about-author"></small>
                <h5>Published</h5>
                <p>Tue 12 June 2018</p>
                <a href="/">&larr;Home</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Customizing a Docker image</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="../../../../tag/docker-image-dockerfile/">Docker image. Dockerfile</a>
                        </p>
                </header>
            </section>
            <h1>Customizing a Docker image</h1>
<p>Problem : Sometimes you have to use Docker images to troubleshoot R package issues. One of the tasks associated with this if for example the installation of system and R dependencies. This installation can be somewhat time consuming. In order to avoid this we can customize a container so that it has the dependencies we need. Here we’ll see how this is accomplished.</p>
<p>We’ve been using the rocker r-devel-san-clang container. A first step is to fork this repository to your own account. The rocker repository can be found here.</p>
<p>https://github.com/mohcinemadkour/r-devel-san-clang
You should be able to find a button in the top right of the page where you can fork the repository. We can now clone it to make a local copy.</p>
<div class="highlight"><pre><span></span>git clone https://github.com/mohcinemadkour/r-devel-san-clang.git
</pre></div>


<p>We can make a branch so that we keep our work seperate from master. Information on branching can be found at the <a href="https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging">git documentation</a>.</p>
<div class="highlight"><pre><span></span>git checkout -b bjk
</pre></div>


<p>We can now open the Dockerfile in our favorite text editor and customize it. In the Dockerfile we’ll see a couplpe of lines as follows.</p>
<div class="highlight"><pre><span></span>RUN apt-get update -qq \
    &amp;&amp; apt-get install -t unstable -y --no-install-recommends \
</pre></div>


<p>This is where we’ll add our system dependencies. Docker’s best practices guide asks us to add our dependencies alphabetically to aid maintenance. We’ll add pandoc and qpdf.</p>
<p>At the end of the file we’ll add a few lines to install our dependencies. For your package you will want to modify this list.</p>
<h2>Install vcfR dependencies</h2>
<div class="highlight"><pre><span></span>RUN R --slave -e &#39;install.packages(c(&quot;ape&quot;, &quot;dplyr&quot;, &quot;knitr&quot;, &quot;poppr&quot;, &quot;Rcpp&quot;, &quot;memuse&quot;, &quot;pinfsc50&quot;, &quot;rmarkdown&quot;, &quot;testthat&quot;, &quot;tidyr&quot;, &quot;vegan&quot;, &quot;viridisLite&quot;), dependencies = TRUE)&#39;
</pre></div>


<p>The Docker documentation includes directions on how to build our app. For our container it should look like this.</p>
<div class="highlight"><pre><span></span>sudo docker build -t r-devel-san-clang .
</pre></div>


<p>Here the -t flag allows us to add a tag. Note that it will take a bit for the dependencies to download and install. Okay, it will take quite a bit.</p>
<p>After everything is installed we should be able to start the image</p>
<div class="highlight"><pre><span></span>sudo docker run --name=r-devel-san-clang -v ~/gits/vcfR:/RSource/vcfR --rm -ti r-devel-san-clang /bin/bash
</pre></div>


<p>While building the container requires an investment in time, the result is that now when we run our image we have all of our dependencies installed and do not have to invest time in to install them. We should be ready to proceed to testing our docker now.</p>
            <div class="hr"></div>
            <a href="#" class="go-top">Go Top</a>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "leafyleap-2"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><footer class="footer">
    <p>&copy; Mohcine Madkour &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>