<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mohcine Madkour, Big Data Architectures and more">


        <title>Analysing Model Perfromance from Receiver Operator Characteristic and Recall and Precision curves // Mohcine Madkour // Big Data Architectures and more</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../theme/css/pure.css">
    <link rel="stylesheet" href="../../../../theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <a href="../../../../author/mohcine-madkour.html" title="See posts by Mohcine Madkour">
                        <img class="avatar" alt="Mohcine Madkour" src="http://www.gravatar.com/avatar/ae08847efc1a85b710f326eb8ee2e907">
                </a>
                <h2 class="article-info">Mohcine Madkour</h2>
                <small class="about-author"></small>
                <h5>Published</h5>
                <p>Sat 09 June 2018</p>
                <a href="/">&larr;Home</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Analysing Model Perfromance from Receiver Operator Characteristic and Recall and Precision curves</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="../../../../tag/roc/">ROC</a>
                                <a class="post-category" href="../../../../tag/auroc/">AUROC</a>
                                <a class="post-category" href="../../../../tag/aucpr/">AUCPR</a>
                                <a class="post-category" href="../../../../tag/f1-score/">F1 Score</a>
                                <a class="post-category" href="../../../../tag/recall/">Recall</a>
                                <a class="post-category" href="../../../../tag/precision/">Precision</a>
                        </p>
                </header>
            </section>
            <p>ROC and PR curves are commonly used to present results for binary decision problems in machine learning. The ROC curve is created by plotting the true positive rate (TPR) against the false positive rate (FPR) at various threshold settings. Each point of the ROC curve (i.e. threshold) corresponds to specific values of sensitivity and specificity. The area under the ROC curve (AUC) is a summary measure of performance that indicates whether on average a true positive is ranked higher than a false positives. If model A has higher AUC than model B, model A is performing better on average, but there still could be specific areas of the ROC space where model B is better (i.e. thresholds for which sensitivity and specificity are higher for model B than A. However, when dealing with highly skewed datasets, Precision-Recall (PR) curves give a more informative picture of an algorithm's performance. There is deep connection between ROC space and PR space, such that a curve dominates in ROC space if  and only if it dominates in PR space. The precision-recall curve shows the tradeoff between precision and recall for different threshold. A high area under the curve represents both high recall and high precision, where high precision, x-axis, relates to a low false positive rate, and high recall, y-axis, relates to a low false negative rate. High scores for both show that the classifier is returning accurate results (high precision), as well as returning a majority of all positive results (high recall).</p>
<h2>Sensitivity (positive in disease)</h2>
<p>Sensitivity is the ability of a test to correctly classify an individual as ′diseased′</p>
<div class="highlight"><pre><span></span><span class="n">Sensitivity</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">a</span><span class="o">+</span><span class="k">c</span>
<span class="o">=</span> <span class="n">a</span> <span class="p">(</span><span class="k">true</span> <span class="n">positive</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="o">+</span><span class="k">c</span> <span class="p">(</span><span class="k">true</span> <span class="n">positive</span> <span class="o">+</span> <span class="k">false</span> <span class="n">negative</span><span class="p">)</span>
<span class="o">=</span> <span class="n">Probability</span> <span class="k">of</span> <span class="n">being</span> <span class="n">test</span> <span class="n">positive</span> <span class="k">when</span> <span class="n">disease</span> <span class="n">present</span><span class="p">.</span>
</pre></div>


<h2>Specificity (negative in health)</h2>
<p>The ability of a test to correctly classify an individual as disease- free is called the test′s specificity</p>
<div class="highlight"><pre><span></span><span class="n">Specificity</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">b</span><span class="o">+</span><span class="n">d</span>
<span class="o">=</span> <span class="n">d</span> <span class="p">(</span><span class="k">true</span> <span class="n">negative</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="o">+</span><span class="n">d</span> <span class="p">(</span><span class="k">true</span> <span class="n">negative</span> <span class="o">+</span> <span class="k">false</span> <span class="n">positive</span><span class="p">)</span>
<span class="o">=</span> <span class="n">Probability</span> <span class="k">of</span> <span class="n">being</span> <span class="n">test</span> <span class="n">negative</span> <span class="k">when</span> <span class="n">disease</span> <span class="n">absent</span><span class="p">.</span>
</pre></div>


<p>Sensitivity and specificity are inversely proportional, meaning that as the sensitivity increases, the specificity decreases and vice versa.</p>
<h2>Positive Predictive Value (PPV)</h2>
<p>It is the percentage of patients with a positive test who actually have the disease. </p>
<div class="highlight"><pre><span></span><span class="n">PPV</span><span class="p">:</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
<span class="o">=</span> <span class="n">a</span> <span class="p">(</span><span class="k">true</span> <span class="n">positive</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="p">(</span><span class="k">true</span> <span class="n">positive</span> <span class="o">+</span> <span class="k">false</span> <span class="n">positive</span><span class="p">)</span>
<span class="o">=</span> <span class="n">Probability</span> <span class="p">(</span><span class="n">patient</span> <span class="k">having</span> <span class="n">disease</span> <span class="k">when</span> <span class="n">test</span> <span class="k">is</span> <span class="n">positive</span><span class="p">)</span>
</pre></div>


<h2>Negative Predictive Value (NPV)</h2>
<p>It is the percentage of patients with a negative test who do not have the disease.</p>
<div class="highlight"><pre><span></span><span class="n">NPV</span><span class="p">:</span>    <span class="o">=</span>   <span class="n">d</span> <span class="o">/</span> <span class="k">c</span><span class="o">+</span><span class="n">d</span>
<span class="o">=</span>   <span class="n">d</span> <span class="p">(</span><span class="k">true</span> <span class="n">negative</span><span class="p">)</span> <span class="o">/</span> <span class="k">c</span><span class="o">+</span><span class="n">d</span> <span class="p">(</span><span class="k">false</span> <span class="n">negative</span> <span class="o">+</span> <span class="k">true</span> <span class="n">negative</span><span class="p">)</span>
<span class="o">=</span>   <span class="n">Probability</span> <span class="p">(</span><span class="n">patient</span> <span class="k">not</span> <span class="k">having</span> <span class="n">disease</span> <span class="k">when</span> <span class="n">test</span> <span class="k">is</span> <span class="n">negative</span><span class="p">)</span>
</pre></div>


<p>Positive and negative predictive values are influenced by the prevalence of disease in the population that is being tested. If we  test in a high prevalence setting, it is more likely that persons who test positive truly have disease than if the test is performed in a population with low prevalence. So the PPV will increase with increasing prevalence and NPV decreases with increase in prevalence.</p>
<h2>Methods to find the ‘optimal’ threshold point</h2>
<p>Three criteria  are  used to  find  optimal  threshold point  from  ROC  curve.  These criteria are known as points on curve closest to the (0, 1), Youden index, and minimize cost criterion. First two methods give equal weight to sensitivity and specificity and impose no ethical, cost, and no prevalence  constraints.  The  third  criterion  considers  cost  which  mainly  includes financial  cost  for  correct  and  false  diagnosis,  cost  of  discomfort  to  person  caused  by treatment, and cost of further investigation when needed.  This method is rarely used in medical literature because it is difficult to estimate the respective costs and prevalence is often difficult to assess.</p>
<p>Youden index  is  more  commonly  used  criterion  because  this  index  reflects  the  intension  to maximize the correct classification 
rate and is easy to calculate. It maximizes the vertical distance from line of equality to the point [x, y] as shown in Figure. The x represents (1-specificity) and y represents sensitivity.  In  other  words,  the  Youden  index  J  is  the  point on the ROC  curve  which  is farthest  from  line  of  equality  (diagonal  line).  The  main  aim of  Youden  index  is  to 
maximize the difference between TPR (sensitivity) and FPR (1 –specificty) and little algebra yields J = max[sensitivity+specificty].  The  value  of  J  for  continuous  test  can  be  located  by  doing  a  search  of plausible  values  where  sum  of  sensitivity  and  specificity  can be  maximum:</p>
<div class="highlight"><pre><span></span><span class="n">j</span><span class="o">=</span> <span class="n">model_metric</span><span class="p">[</span><span class="s1">&#39;thres&#39;</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">model_metric</span><span class="p">[</span><span class="s1">&#39;yod_index&#39;</span><span class="p">].</span><span class="n">idxmax</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>


<p>Sometimes a second cutoff that is bigger than j but less than 1 is needed. This cutoff can be used to stratify the positively predicted values to moderate and high prediction for example(needed for risk prediction stratification). This cutoff can be calculated using the accuracy measurement using the following method:</p>
<div class="highlight"><pre><span></span><span class="n">cutoff2</span><span class="o">=</span><span class="n">cu</span><span class="p">.</span><span class="n">cal_cutoff2</span><span class="p">(</span><span class="n">model_metric</span><span class="p">)</span>
</pre></div>


<p>with</p>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">cal_cutoff2</span><span class="ss">(</span><span class="nv">data</span><span class="ss">)</span>:
    <span class="nv">val</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">data</span><span class="ss">)</span><span class="o">-</span><span class="mi">10</span><span class="ss">)</span>:
    <span class="k">if</span><span class="ss">((</span><span class="nv">abs</span><span class="ss">(</span><span class="nv">data</span>[<span class="s1">&#39;</span><span class="s">acc</span><span class="s1">&#39;</span>].<span class="nv">iloc</span>[<span class="nv">i</span>]<span class="o">-</span><span class="nv">data</span>[<span class="s1">&#39;</span><span class="s">acc</span><span class="s1">&#39;</span>].<span class="nv">iloc</span>[<span class="nv">i</span><span class="o">+</span><span class="mi">10</span>]<span class="ss">))</span><span class="o">&lt;</span><span class="mi">0</span>.<span class="mi">002</span><span class="ss">)</span>:
        <span class="nv">val</span><span class="o">=</span><span class="nv">data</span>[<span class="s1">&#39;</span><span class="s">thres</span><span class="s1">&#39;</span>].<span class="nv">iloc</span>[<span class="nv">i</span>]
        <span class="k">break</span>
    <span class="k">return</span><span class="ss">(</span><span class="nv">val</span><span class="ss">)</span>
</pre></div>


<p>The chart bellow illustrates the relationship between the different performance metrics ( prevalence is exluded) in an example of 4 estimators apllied on 4 -classes data<img alt=" PPV and NPV  relationship" src="/images/NPV-PPV-Accracy-Youden.png"></p>
<h1>Calculation of performance metrics</h1>
<p>Here is the python code for the calculation of  performance metrics </p>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">calculate_metric</span><span class="ss">(</span><span class="nv">outcome</span>, <span class="nv">score</span><span class="ss">)</span>:
    <span class="nv">obser</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">outcome</span><span class="ss">))</span>
    <span class="nv">obser</span>[[<span class="nv">i</span> <span class="k">for</span> <span class="nv">i</span>, <span class="nv">x</span> <span class="nv">in</span> <span class="nv">enumerate</span><span class="ss">(</span><span class="nv">outcome</span><span class="ss">)</span> <span class="k">if</span> <span class="nv">x</span> <span class="o">==</span> <span class="mi">1</span> ]] <span class="o">=</span> <span class="mi">1</span> <span class="c1">;</span>
    <span class="nv">obser</span> <span class="o">=</span> [<span class="nv">float</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span> <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">obser</span>]
    <span class="nv">score</span> <span class="o">=</span> [<span class="nv">float</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span> <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">score</span>]
    <span class="nv">prev</span> <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">sum</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span><span class="o">/</span><span class="nv">len</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span>,<span class="mi">2</span><span class="ss">)</span>
    <span class="nv">thres</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">arange</span><span class="ss">(</span><span class="mi">0</span>.<span class="mi">01</span>,<span class="mi">1</span>.<span class="mi">01</span>,<span class="mi">0</span>.<span class="mi">01</span><span class="ss">)</span>#<span class="ss">(</span><span class="mi">0</span>.<span class="mi">01</span>,<span class="mi">0</span>.<span class="mi">98</span>,<span class="mi">0</span>.<span class="mi">01</span><span class="ss">)</span>
    <span class="nv">xval</span> <span class="o">=</span> <span class="nv">thres</span>
    <span class="nv">acc</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">ppv</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">npv</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">sen</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">spe</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">yod</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">auc</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">recall</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">precision</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>
    <span class="nv">F1</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span> 
    <span class="k">for</span> <span class="nv">l</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">thres</span><span class="ss">))</span>:
        <span class="nv">plotdata</span> <span class="o">=</span> <span class="nv">ROC_parameters</span><span class="ss">(</span><span class="nv">obser</span>,<span class="nv">score</span>,<span class="nv">thres</span>[<span class="nv">l</span>]<span class="ss">)</span>
        <span class="nv">acc</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">0</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">ppv</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">1</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">npv</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">2</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">sen</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">3</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">spe</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">4</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">yod</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">5</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">recall</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">6</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">precision</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">7</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">F1</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">plotdata</span>[<span class="mi">8</span>],<span class="mi">3</span><span class="ss">)</span>
        <span class="nv">auc</span>[<span class="nv">l</span>] <span class="o">=</span> <span class="nv">roc_auc_score</span><span class="ss">(</span><span class="nv">obser</span>, <span class="nv">score</span><span class="ss">)</span>
    <span class="nv">prev</span> <span class="o">=</span> <span class="nv">round</span><span class="ss">(</span><span class="nv">sum</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span><span class="o">/</span><span class="nv">len</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span>,<span class="mi">2</span><span class="ss">)</span>
    #<span class="nv">roc_vals</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">((</span><span class="nv">length</span><span class="ss">(</span><span class="nv">spe</span><span class="ss">)</span>,<span class="mi">8</span><span class="ss">))</span>
    <span class="nv">roc_vals</span><span class="o">=</span><span class="nv">pd</span>.<span class="nv">DataFrame</span><span class="ss">(</span><span class="nv">index</span><span class="o">=</span><span class="nv">range</span><span class="ss">(</span><span class="mi">1</span>,<span class="mi">101</span><span class="ss">)</span>, <span class="nv">columns</span><span class="o">=</span>[[<span class="s2">&quot;</span><span class="s">thres</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">acc</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">ppv</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">npv</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">specificity</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">sensitivity</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">yod_index</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">recall</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">precision</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">F1</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">auc</span><span class="s2">&quot;</span>]]<span class="ss">)</span>
    #<span class="nv">roc_vals</span> <span class="o">&lt;-</span> <span class="nv">dacolnames</span><span class="ss">(</span><span class="nv">roc_vals</span><span class="ss">)</span> <span class="o">&lt;-</span> <span class="nv">c</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">thres</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">acc</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">ppv</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">npv</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">specificity</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">sensitivity</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">yod_index</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">auc</span><span class="s2">&quot;</span><span class="ss">)</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">thres</span><span class="s1">&#39;</span>]<span class="o">=</span><span class="nv">thres</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">acc</span><span class="s1">&#39;</span>]<span class="o">=</span> <span class="nv">acc</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">ppv</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">ppv</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">npv</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">npv</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">specificity</span><span class="s1">&#39;</span>] <span class="o">=</span><span class="nv">spe</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">sensitivity</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">sen</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">yod_index</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">yod</span><span class="c1">;</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">recall</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">recall</span><span class="c1">;</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">precision</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">precision</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">F1</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">F1</span><span class="c1">;</span>
    <span class="nv">roc_vals</span>[<span class="s1">&#39;</span><span class="s">auc</span><span class="s1">&#39;</span>] <span class="o">=</span> <span class="nv">auc</span><span class="c1">;</span>
    <span class="k">return</span> <span class="nv">roc_vals</span>

<span class="nv">def</span> <span class="nv">ROC_parameters</span><span class="ss">(</span><span class="nv">obser</span>,<span class="nv">score</span>,<span class="nv">thr</span><span class="ss">)</span>:
    #<span class="nv">print</span> <span class="nv">obser</span>,<span class="nv">score</span>,<span class="nv">thr</span>
    <span class="nv">temp</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">zeros</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">score</span><span class="ss">))</span>
    #<span class="nv">print</span> <span class="nv">thr</span><span class="c1">;</span>
    <span class="nv">temp</span>[[ <span class="nv">i</span> <span class="k">for</span> <span class="nv">i</span>, <span class="nv">x</span> <span class="nv">in</span> <span class="nv">enumerate</span><span class="ss">(</span><span class="nv">score</span><span class="ss">)</span> <span class="k">if</span> <span class="nv">x</span> <span class="o">&gt;=</span> <span class="nv">thr</span> ]]<span class="o">=</span> <span class="mi">1</span>
    <span class="nv">p_ind</span><span class="o">=</span>[ <span class="nv">i</span> <span class="k">for</span> <span class="nv">i</span>, <span class="nv">x</span> <span class="nv">in</span> <span class="nv">enumerate</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span> <span class="k">if</span> <span class="nv">x</span> <span class="o">==</span> <span class="mi">1</span> ]
    <span class="nv">n_ind</span> <span class="o">=</span> [ <span class="nv">i</span> <span class="k">for</span> <span class="nv">i</span>, <span class="nv">x</span> <span class="nv">in</span> <span class="nv">enumerate</span><span class="ss">(</span><span class="nv">obser</span><span class="ss">)</span> <span class="k">if</span> <span class="nv">x</span> <span class="o">==</span> <span class="mi">0</span> ]
    <span class="nv">TP</span> <span class="o">=</span> <span class="nv">sum</span><span class="ss">(</span><span class="nv">temp</span>[<span class="nv">p_ind</span>]<span class="o">==</span><span class="mi">1</span><span class="ss">)</span>
    <span class="nv">FP</span> <span class="o">=</span> <span class="nv">sum</span><span class="ss">(</span><span class="nv">temp</span>[<span class="nv">n_ind</span>]<span class="o">==</span><span class="mi">1</span><span class="ss">)</span>
    <span class="nv">TN</span> <span class="o">=</span><span class="nv">sum</span><span class="ss">(</span><span class="nv">temp</span>[<span class="nv">n_ind</span>]<span class="o">==</span><span class="mi">0</span><span class="ss">)</span>
    <span class="nv">FN</span> <span class="o">=</span> <span class="nv">sum</span><span class="ss">(</span><span class="nv">temp</span>[<span class="nv">p_ind</span>]<span class="o">==</span><span class="mi">0</span><span class="ss">)</span>
    <span class="nv">acc</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TP</span><span class="o">+</span><span class="nv">TN</span><span class="ss">)</span><span class="o">/</span><span class="nv">len</span><span class="ss">(</span><span class="nv">temp</span><span class="ss">)</span>
    <span class="nv">recall</span><span class="o">=</span><span class="mi">0</span>
    <span class="nv">precision</span><span class="o">=</span><span class="mi">0</span>
    #<span class="nv">print</span> <span class="nv">TP</span>,<span class="nv">FP</span>,<span class="nv">TN</span>,<span class="nv">FN</span><span class="c1">;</span>
    <span class="k">if</span> <span class="nv">TP</span><span class="o">+</span><span class="nv">FP</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">ppv</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TP</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TP</span><span class="o">+</span><span class="nv">FP</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">ppv</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="k">if</span> <span class="nv">TN</span><span class="o">+</span><span class="nv">FN</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">npv</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TN</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TN</span><span class="o">+</span><span class="nv">FN</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">npv</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="k">if</span> <span class="nv">TP</span><span class="o">+</span><span class="nv">FN</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">sen</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TP</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TP</span><span class="o">+</span><span class="nv">FN</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">sen</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="k">if</span> <span class="nv">TN</span><span class="o">+</span><span class="nv">FP</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">spe</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TN</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TN</span><span class="o">+</span><span class="nv">FP</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">spe</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="k">if</span> <span class="nv">TP</span><span class="o">+</span><span class="nv">FN</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">recall</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TP</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TP</span><span class="o">+</span><span class="nv">FN</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">recall</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>    
    <span class="k">if</span> <span class="nv">TP</span><span class="o">+</span><span class="nv">FP</span><span class="o">&gt;</span><span class="mi">0</span>:
        <span class="nv">precision</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">TP</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">TP</span><span class="o">+</span><span class="nv">FP</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">precision</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="k">if</span> <span class="nv">recall</span><span class="o">+</span><span class="nv">precision</span><span class="o">&gt;</span><span class="mi">0</span>:         
        <span class="nv">F1</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)((</span><span class="mi">2</span><span class="o">*</span><span class="nv">recall</span><span class="o">*</span><span class="nv">precision</span><span class="ss">)</span><span class="o">/</span><span class="ss">(</span><span class="nv">recall</span><span class="o">+</span><span class="nv">precision</span><span class="ss">))</span>
    <span class="k">else</span>:
        <span class="nv">F1</span><span class="o">=</span><span class="nv">np</span>.<span class="nv">NaN</span>
    <span class="nv">yod</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">float</span><span class="ss">)(</span><span class="nv">sen</span><span class="o">+</span><span class="nv">spe</span><span class="o">-</span><span class="mi">1</span><span class="ss">)</span>
    <span class="nv">ls</span><span class="o">=</span><span class="nv">list</span><span class="ss">()</span><span class="c1">;</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">acc</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">ppv</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">npv</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">sen</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">spe</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">yod</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">recall</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">precision</span><span class="ss">)</span>
    <span class="nv">ls</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">F1</span><span class="ss">)</span>
    <span class="k">return</span> <span class="nv">ls</span>
</pre></div>


<h1>calculating performance measurements and confidence intervals using Boostraping</h1>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">calculate_metric_boostrap</span><span class="ss">(</span><span class="nv">outcome</span>, <span class="nv">score</span><span class="ss">)</span>:
    <span class="nv">d</span> <span class="o">=</span> []
    <span class="k">for</span> <span class="nv">p</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="mi">0</span>,<span class="nv">len</span><span class="ss">(</span><span class="nv">score</span><span class="ss">))</span>:
        <span class="nv">d</span>.<span class="nv">append</span><span class="ss">((</span><span class="nv">score</span>[<span class="nv">p</span>]<span class="ss">))</span>
    <span class="nv">score</span><span class="o">=</span><span class="nv">pd</span>.<span class="nv">Series</span><span class="ss">(</span><span class="nv">d</span><span class="ss">)</span>
    <span class="nv">n_bootstraps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nv">rng_seed</span> <span class="o">=</span> <span class="mi">42</span>  # <span class="nv">control</span> <span class="nv">reproducibility</span>
    <span class="nv">scores_table</span> <span class="o">=</span> {} 
    <span class="nv">rng</span> <span class="o">=</span> <span class="nv">np</span>.<span class="k">random</span>.<span class="nv">RandomState</span><span class="ss">(</span><span class="nv">rng_seed</span><span class="ss">)</span>
    <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="nv">n_bootstraps</span><span class="ss">)</span>:
    # <span class="nv">bootstrap</span> <span class="nv">by</span> <span class="nv">sampling</span> <span class="nv">with</span> <span class="nv">replacement</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">prediction</span> <span class="nv">indices</span>
        <span class="nv">indices</span> <span class="o">=</span> <span class="nv">rng</span>.<span class="nv">random_integers</span><span class="ss">(</span><span class="mi">0</span>, <span class="nv">len</span><span class="ss">(</span><span class="nv">outcome</span><span class="ss">)</span> <span class="o">-</span> <span class="mi">1</span>, <span class="nv">len</span><span class="ss">(</span><span class="nv">outcome</span><span class="ss">))</span>
        <span class="k">if</span> <span class="nv">len</span><span class="ss">(</span><span class="nv">np</span>.<span class="nv">unique</span><span class="ss">(</span><span class="nv">outcome</span>[<span class="nv">indices</span>]<span class="ss">))</span> <span class="o">&lt;</span> <span class="mi">2</span>:
        # <span class="nv">We</span> <span class="nv">need</span> <span class="nv">at</span> <span class="nv">least</span> <span class="nv">one</span> <span class="nv">positive</span> <span class="nv">and</span> <span class="nv">one</span> <span class="nv">negative</span> <span class="nv">sample</span> <span class="k">for</span> <span class="nv">ROC</span> <span class="nv">AUC</span>
        # <span class="nv">to</span> <span class="nv">be</span> <span class="nv">defined</span>: <span class="nv">reject</span> <span class="nv">the</span> <span class="nv">sample</span>
            <span class="k">continue</span>
        <span class="nv">scores_table</span>[<span class="nv">i</span>]<span class="o">=</span> <span class="nv">calculate_metric</span><span class="ss">(</span><span class="nv">outcome</span>[<span class="nv">indices</span>], <span class="nv">score</span>[<span class="nv">indices</span>]<span class="ss">)</span>

    <span class="nv">panel</span> <span class="o">=</span> <span class="nv">pd</span>.<span class="nv">Panel</span><span class="ss">(</span><span class="nv">scores_table</span><span class="ss">)</span>
    <span class="nv">df</span><span class="o">=</span><span class="nv">panel</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">axis</span><span class="o">=</span><span class="mi">0</span><span class="ss">)</span>
    <span class="k">return</span> <span class="nv">df</span>,<span class="nv">panel</span>

<span class="nv">def</span> <span class="nv">confidence_interval</span><span class="ss">(</span><span class="nv">panel</span><span class="ss">)</span>:
    <span class="nv">vector</span> <span class="o">=</span> []
    <span class="nv">confidence_lower</span><span class="o">=</span><span class="nv">panel</span>[<span class="mi">1</span>].<span class="nv">copy</span><span class="ss">()</span>
    <span class="nv">confidence_upper</span><span class="o">=</span><span class="nv">panel</span>[<span class="mi">1</span>].<span class="nv">copy</span><span class="ss">()</span>
    <span class="nv">nr</span><span class="o">=</span><span class="nv">len</span><span class="ss">(</span><span class="nv">panel</span>[<span class="mi">1</span>].<span class="nv">axes</span>[<span class="mi">0</span>]<span class="ss">)</span>
    <span class="nv">nc</span><span class="o">=</span><span class="nv">len</span><span class="ss">(</span><span class="nv">panel</span>[<span class="mi">1</span>].<span class="nv">axes</span>[<span class="mi">1</span>]<span class="ss">)</span>
    <span class="k">for</span> <span class="nv">ix</span> <span class="nv">in</span>  <span class="nv">range</span><span class="ss">(</span><span class="mi">0</span>,<span class="nv">nr</span><span class="ss">)</span>:
        <span class="k">for</span> <span class="nv">iy</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="mi">0</span>,<span class="nv">nc</span><span class="ss">)</span>:
            <span class="nv">vector</span> <span class="o">=</span> []
            <span class="k">for</span> <span class="nv">k</span>, <span class="nv">df</span> <span class="nv">in</span> <span class="nv">panel</span>.<span class="nv">iteritems</span><span class="ss">()</span>:
                <span class="nv">vector</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">df</span>.<span class="nv">iloc</span>[<span class="nv">ix</span>,<span class="nv">iy</span>]<span class="ss">)</span>
            <span class="nv">sorted_vector</span> <span class="o">=</span> <span class="nv">np</span>.<span class="nv">array</span><span class="ss">(</span><span class="nv">vector</span><span class="ss">)</span>
            <span class="nv">sorted_vector</span>.<span class="nv">sort</span><span class="ss">()</span>
            <span class="nv">confidence_lower</span>.<span class="nv">iloc</span>[<span class="nv">ix</span>,<span class="nv">iy</span>] <span class="o">=</span> <span class="nv">sorted_vector</span>[<span class="nv">int</span><span class="ss">(</span><span class="mi">0</span>.<span class="mi">05</span> <span class="o">*</span> <span class="nv">len</span><span class="ss">(</span><span class="nv">sorted_vector</span><span class="ss">))</span>]
            <span class="nv">confidence_upper</span>.<span class="nv">iloc</span>[<span class="nv">ix</span>,<span class="nv">iy</span>] <span class="o">=</span> <span class="nv">sorted_vector</span>[<span class="nv">int</span><span class="ss">(</span><span class="mi">0</span>.<span class="mi">95</span> <span class="o">*</span> <span class="nv">len</span><span class="ss">(</span><span class="nv">sorted_vector</span><span class="ss">))</span>]
    <span class="k">return</span> <span class="nv">confidence_lower</span>, <span class="nv">confidence_upper</span>
</pre></div>


<p>The chart bellow illustrates ROC and PR curves for 4 different estimators applied on the same data<img alt=" ROC" src="/images/ROC-PV1.png"><img alt=" PR" src="/images/ROC-PV2.png">
The performances of the algorithms appear to be comparable in ROC space, however, in PR space we can see that Estimator 4 has a clear advantage over Estimator 3.</p>
            <div class="hr"></div>
            <a href="#" class="go-top">Go Top</a>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "leafyleap-2"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><footer class="footer">
    <p>&copy; Mohcine Madkour &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>