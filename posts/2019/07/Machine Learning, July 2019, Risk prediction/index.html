<!DOCTYPE html>
<html lang="en">
<head>
          <title>Mohcine Madkour</title>
        <meta charset="utf-8" />


    <meta name="tags" content="Machine Learning" />
    <meta name="tags" content="July 2019" />
    <meta name="tags" content="Risk prediction" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">Mohcine Madkour <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="pages/about.html">About</a></li>
            <li><a href="pages/biography.html">Biography</a></li>
            <li><a href="../../../../pages/about.html">About</a></li>
            <li><a href="../../../../pages/biography.html">Biography</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../../../posts/2019/07/Machine Learning, July 2019, Risk prediction/" rel="bookmark"
         title="Permalink to Type 2 Diabetes - Risk Predictions">Type 2 Diabetes - Risk Predictions</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2019-07-12T13:01:00-04:00">
      Fri 12 July 2019
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="../../../../author/mohcine-madkour.html">Mohcine Madkour</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Type 2 diabetes is a chronic condition that affects the way the body metabolizes sugar (glucose). With type 2 diabetes, the body either resists the effects of insulin (a hormone that regulates the movement of sugar into cells) or it doesn't produce enough insulin to maintain normal glucose levels. Type 2 diabetes occurs more commonly in middle-aged and elderly people. Uncontrolled it can cause all sorts of very bad things: infections, damaged kidneys, vision loss and blindness, amputations and many more. So, there is no question that type 2 diabetes needs to be taken seriously and treated. Type 2 diabetes is usually diagnosed using the <strong>glycated hemoglobin (A1C)</strong> test. This blood test indicates the average blood sugar level for the past two to three months. Normal levels are below 5.7 percent, and a result between 5.7 and 6.4 percent is considered prediabetes. An A1C level of 6.5 percent or higher on two separate tests means you have diabetes.</p>
<p>People who have diabetes need this test regularly to see if their levels are staying within range and if they need to adjust their diabetes medicines. To treat type 2 diabetes lifestyle changes are very effective, and the side effects of eating more healthfully and staying more active are positive ones. In this project I will try to predict A1C levels: no-diabetes, pre-diabetes and diabetes. I will transform the dataset from a regression task (A1C) into a multi-class classification task (3 A1C levels).</p>
<p><img alt="png" src="/images/A1c_normal_to_high_ranges.png"></p>
<h3>Diabetes Dataset</h3>
<p>These data are courtesy of Dr John Schorling, Department of Medicine, University of Virginia School of Medicine which can be obtained from http://biostat.mc.vanderbilt.edu/DataSets.</p>
<p>The data consist of <strong>19</strong> variables on <strong>403</strong> subjects from <strong>1046</strong> subjects who were interviewed in a study to understand the prevalence of obesity, diabetes, and other cardiovascular risk factors in central Virginia for African Americans. According to Dr John Hong, Diabetes Mellitus Type II (adult onset diabetes) is associated most strongly with obesity. The waist/hip ratio may be a predictor in diabetes and heart disease. Type 2 Diabetes is also associated with hypertension - they may both be part of <strong>Metabolic Syndrome</strong>.</p>
<p><strong>Metabolic syndrome</strong> is a collection of risk factors that includes high blood pressure, high blood sugar, excess body fat around the waist, and abnormal cholesterol levels. The syndrome increases the chance of developing heart disease, stroke, and diabetes. Aside from a large waist circumference, most of the disorders associated with metabolic syndrome have no symptoms. Losing weight, exercise, and dietary changes can help prevent or reverse metabolic syndrome. According to a national health survey, more than 1 in 5 Americans has metabolic syndrome. The number of people with metabolic syndrome increases with age, affecting more than 40% of people in their 60s and 70s.</p>
<p>The 403 subjects were the ones who were actually screened for diabetes. Glycosolated hemoglobin (A1C) &gt; 7.0 is usually taken as a positive diagnosis of diabetes. </p>
<h3>Description of Features:</h3>
<p>There are 403 observations and 19 features in this dataset, maximum # NaNs:262.</p>
<p><img alt="png" src="/images/anonymous2x.png"></p>
<h3>Challenges</h3>
<p>I were facing two challenegs with my dataset:</p>
<ul>
<li>relatively small number of observations </li>
<li>imbalanced classes (A1C levels)</li>
</ul>
<p>To overcome the issues with imbalanced data, I will use several techniques:</p>
<ol>
<li>f1 macro averaged score for performance metric</li>
<li>cost-sensitive learning (penalize algorithms)</li>
<li>SMOTE - Synthetic Minority Over-sampling Technique</li>
</ol>
<p>and several machine learning algorithms:</p>
<ol>
<li>$L_1$-regularized Logistic Regression</li>
<li>$L_2$-regularized Logistic Regression</li>
<li>Support Vector Machine (SVM)</li>
<li>Random Forest</li>
<li>Gradient Boosting</li>
<li>AdaBoost</li>
</ol>
<p>All together, I have trained 22 models.</p>
<h3>FindingsWe</h3>
<ul>
<li>From my limited sample I could not find any single condition that would alone increase the risk for type 2 diabetes.</li>
<li>I found that several factors could impact risks for the person to be diagnosed with diabetes: age, high cholesterol ratio, high blood presure, increased weight... </li>
<li>Even if you have all these conditions it does not mean you will have type 2 diabetes. This will make very difficult for my models to predict A1C levels.</li>
<li>Due to imbalanced data, all models had problems with predicting minority classes: <code>pre_diabetes</code> and <code>diabetes</code>. They were mostly predicting the majority class, <code>no_diabetes</code>.</li>
<li>At the end, I found that Random Forest algorithm with <strong>cost_sensitive learning</strong> did the best with <strong>f1 macro score</strong> of 0.56.</li>
</ul>
<h2>Exploratory Analysis</h2>
<ul>
<li>The feature names got changed to make more sense</li>
<li>As I expected, there are 403 observations and 19 features in the data set.</li>
<li>There are 16 numerical features and 3 categorical features. All data types are correct</li>
</ul>
<p><strong>Unused Features</strong></p>
<p>To make dataframe easily readable I will remove unused features like <code style="color:steelblue">id</code> and <code style="color:steelblue">location</code>.</p>
<p>The goal of this project is to predict ranges of A1C. From a quick look through my dataframe I could see that the postprandial time when labs were drawn varies. So, let's check its distribution.</p>
<p><img alt="png" src="/images/o_output_24_1.png"></p>
<p>Since the postprandial time when labs were drawn has very wide range, from 5 minutes to 26 hours, I could remove <code style="color:steelblue">stab_glu</code> and <code style="color:steelblue">time_ppn</code> features.</p>
<p>The number of features has been decreased to 15.</p>
<h3>Distributions of Numeric Features</h3>
<p><strong>Plotting the histogram grid</strong></p>
<p><img alt="png" src="/images/output_31_0.png"></p>
<p>All distributions look OK. Only for <code style="color:steelblue">a1c</code> I could see many observations around 5% (healthy range). This might be an indication of imbalanced data classes once I transfer <code style="color:steelblue">a1c</code> to 3 classes.</p>
<p><strong>Summary statistics for the numeric features</strong></p>
<p><img alt="png" src="/images/Screenshot_from_2020_02_23_00_13_09.png"></p>
<p>From the summary statistics and the visualizations I can conclude that all features look OK. I do not see any extreme values for any feature.</p>
<p>This time I can see from the plot and from grouping that average <code style="color:steelblue">a1c</code> increases with body frame size.</p>
<p>I will keep all outliers. They just represent high and, for some observations, extreme values of <code style="color:steelblue">a1c</code>.</p>
<h3>Correlations</h3>
<p>Let's calculate correlations to take a look at the relationships between numeric features and other numeric features.</p>
<p>I are going to sort features in order of their correlation with <code style="color:steelblue">a1c</code>. This will make easier to see stronger correlations for <code style="color:steelblue">a1c</code>.</p>
<p>It is not easy to digest this big dataframe.
Let's use Seaborn's <code>.heatmap()</code> function to visualize the correlation grid.</p>
<p><img alt="png" src="/images/output_56_0.png"></p>
<p>I can see few obvious stronger correlations:
* <code style="color:steelblue">weight</code> and <code style="color:steelblue">waist</code> and <code style="color:steelblue">hip</code>
* blood presure measurements
* cholesterol ratio and <code style="color:steelblue">chol</code> and <code style="color:steelblue">hdl</code></p>
<p>But there are only few week correlations with <code style="color:steelblue">a1c</code>:
* <code style="color:steelblue">chol_ratio</code>, <code style="color:steelblue">age</code>, <code style="color:steelblue">waist</code> ...</p>
<p><img alt="png" src="/images/pairplot_health_risk_r.png"></p>
<p><img alt="png" src="/images/output_162_0.png"></p>
<p>The above plot is showing us that age is one of the key factors for diabetes risk. The age median and mean for risk classes are separated, but the variance is so high. That means that I have to look at many other factors that could contribute to higher risks for diabetes.</p>
<p><img alt="png" src="/images/output_164_0.png"></p>
<p>Similar to the previous plot, higher bmi could lead to diabetes risk increase. But the variance is high and there is no strong direct correlation for that.</p>
<p>Let's now plot a bivariate segmentation for <code style="color:steelblue">bmi</code> and <code style="color:steelblue">age</code> segmented by <code style="color:steelblue">health_risk</code>.</p>
<p><img alt="png" src="/images/output_166_0.png"></p>
<p>From this chart I can see less <code>diabetes</code> and <code>pre_diabetes</code> observations and more <code>no_diabetes</code> observations for lower <code style="color:steelblue">age</code> and lower <code style="color:steelblue">bmi</code>. </p>
<h2>Algorithm Selection</h2>
<p>I have transformed the original dataset to the <strong>multi-class classification task</strong>.
The chosen algorithms are all known to work well in this kind of task:</p>
<ol>
<li>$L_1$-regularized Logistic Regression</li>
<li>$L_2$-regularized Logistic Regression</li>
<li>Support Vector Machine (SVM)</li>
<li>Random Forest</li>
<li>Gradient Boosting</li>
<li>AdaBoost</li>
</ol>
<p><img alt="png" src="/images/Screenshot_from_2020_02_23_00_53_39.png"></p>
<h2>Insights &amp; Analysis</h2>
<p>My dataset was relatively small and imbalanced and I had to employ several techniques for handling imbalanced classes:</p>
<ol>
<li>f1 macro averaged score for performance metric</li>
<li>cost-sensitive learning (penalize algorithms)</li>
<li>SMOTE - Synthetic Minority Over-sampling Technique</li>
</ol>
<p>I have used six machine learning algorithms: $L_1$ and $L_2$ regularized Logistic Regressions, SVM and three tree ensembles, Random Forest, Gradient Boost and AdaBoost.</p>
<p>In total, I have trained 22 models.</p>
<ul>
<li>Plain models, without any of the above listed techniques, did prety bad with predicting minority classes. They mostly predicted the majority class. Because of that, their accuracy score was high, but f1-macro score was low. As expected, tree ensembles models, were performed slightly better.</li>
<li>All three techniques listed above, made a positive difference. Again, tree ensemble models produced better performance.</li>
<li>I could not find one single health condition that could alone increase the risk of being diagnosed with type 2 diabetes.</li>
<li>It looks that they are working differently for different people.</li>
<li>From my limited sample, I could conclude that the most contributing factors were age, cholesterol ratio and waist cirumference.</li>
</ul>
<p><strong>Winning model</strong></p>
<p>The Random Forest model with cost-sensitive learning have produced the best performance:</p>
<ul>
<li>prety good on the majority class - recall=0.83</li>
<li>on the diabetes class not so bad - recall=0.58</li>
<li>not so good on the smallest, pre-diabetes, class - recall=0.29</li>
</ul>
<p><strong>It is interesting to note the following regarding predicting pre-diabetes:</strong></p>
<ul>
<li>there were only 7 labels in the test set</li>
<li>recall=0.29 means 2 successfully predicted labels and in addition to my winning model, only 3 models had this score: Gradient Boost, Random Forest and SVM all with SMOTE </li>
<li>only 2 models succeded in 3 positive prediction, recall=0.43. Surprisingly, that was $L_2$-regularized Logistic Regression with SMOTE and cost-sensitive learning.</li>
</ul>
<h2>Possible Improvements and Expansions</h2>
<p>These are some of possible improvements/expansions for this project:</p>
<ul>
<li>Acquire a bigger dataset so that the smallest class will have more than 7 points in the test set. And maybe, a bigger sample could produce different relationships among the features.</li>
<li>Additional hyperparameters tuning on few best performing models</li>
<li>Perform additional feature selection and dimensionality reduction (PCA)</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/50245684/using-smote-with-gridsearchcv-in-scikit-learn">Using Smote with Gridsearchcv in Scikit-learn</a></li>
<li><a href="https://scikit-learn.org/stable/modules/model_evaluation.html#precision-recall-f-measure-metrics">Model evaluation: quantifying the quality of predictions</a></li>
<li><a href="https://www.kaggle.com/eikedehling/exploring-class-imbalance-resampling-and-weights">Exploring class imbalance, resampling and weights</a></li>
<li><a href="https://www.geeksforgeeks.org/multiclass-classification-using-scikit-learn/">Multiclass classification using scikit-learn</a></li>
<li><a href="https://www.ritchieng.com/machine-learning-evaluate-classification-model/">Evaluating a Classification Model</a></li>
<li><a href="https://elitedatascience.com/imbalanced-classes">How to Handle Imbalanced Classes in Machine Learning</a></li>
<li><a href="https://towardsdatascience.com/methods-for-dealing-with-imbalanced-data-5b761be45a18">Dealing with Imbalanced Data</a></li>
<li><a href="https://towardsdatascience.com/a-deep-dive-into-imbalanced-data-over-sampling-f1167ed74b5">A Deep Dive Into Imbalanced Data: Over-Sampling</a></li>
<li><a href="https://www.webmd.com/diabetes/guide/glycated-hemoglobin-test-hba1c?print=true">Hemoglobin A1c (HbA1c) Test for Diabetes</a></li>
<li><a href="https://www.mayoclinic.org/diseases-conditions/type-2-diabetes/diagnosis-treatment/drc-20351199">Type 2 diabetes</a></li>
<li><a href="https://www.health.harvard.edu/blog/rethinking-a1c-goals-for-type-2-diabetes-2018032613452">Rethinking A1c goals for type 2 diabetes</a></li>
<li><a href="https://www.cdc.gov/healthyweight/assessing/bmi/adult_bmi/index.html#Interpreted">About Adult BMI</a></li>
<li><a href="https://www.medicalnewstoday.com/articles/319439.php">Why is the hip-waist ratio important?</a></li>
<li><a href="https://universityhealthnews.com/daily/heart-health/cholesterol-ratio-more-important-than-total-cholesterol-or-ldl-cholesterol/">What Is Cholesterol Ratio?</a></li>
<li><a href="https://www.healthline.com/health/blood-pressure-chart">Hypertension Chart - Understanding Your Blood Pressure</a></li>
<li><a href="https://www.webmd.com/diabetes/news/20050310/waist-size-predicts-diabetes-risk?print=true">Waist Size Predicts Diabetes Risk</a></li>
</ul>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>